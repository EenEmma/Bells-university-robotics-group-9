#include <Servo.h>
#include <Wire.h>
#include <LiquidCrystal.h>
const int rs = 12, en = 11, d4 = 5, d5 = 4, d6 = 3, d7 = 2;
LiquidCrystal lcd(rs, en, d4, d5, d6, d7);
Servo gateServo;
const int servoPin = 6;
const int trigPin = 9;
const int echoPin = 8; 
const int buzzerPin = 7;
int count = 0;
char c;
String id;
long duration;
int distance;
void setup() {
  Serial.begin(9600);
  lcd.begin(16, 2);
  lcd.print("Smart Entry/Exit");
  delay(2000);
  lcd.clear();
  lcd.print("please scan your RFID tag");

 gateServo.attach(servoPin);
 gateServo.write(0);

 pinMode(trigPin, OUTPUT);
 pinMode(echoPin, INPUT);
 pinMode(buzzerPin, OUTPUT);
 digitalWrite(buzzerPin, LOW);
}
void loop() {
  while(Serial.available()>0)
  {
    c = Serial.read();
   count++;
   id += c;
   if(count == 12)  
    {
      Serial.print(id);
      //break;
     
      if(id=="1234578900bn")
      {
        Serial.println("Valid TAG");
        lcd.clear();
        lcd.print("Access Granted");
        delay(2000);
        lcd.clear();
        lcd.print("Opening Gate...");
        delay(3000);
        gateServo.write(180);
        digitalWrite(trigPin, LOW);
        delayMicroseconds(2);
        digitalWrite(trigPin, HIGH);
        delayMicroseconds(10);
        digitalWrite(trigPin, LOW);
        duration = pulseIn(echoPin, HIGH);
        distance = duration *0.034/2;
        if(distance < 20) 
        {
         lcd.clear();
         lcd.print("Enter please");
         delay(2000);
         gateServo.write(180);
         delay(5000);
         lcd.clear();
         lcd.print("Closing Gate...");
         gateServo.write(0);
        }
      }
      else {
          lcd.clear();
          lcd.print("Access Denied");
          digitalWrite(buzzerPin, HIGH);
          delay(5000);
          digitalWrite(buzzerPin, LOW);
          delay(1000);
          gateServo.write(0);
        }
    }
  }
  count = 0;
  id = "";
  delay(5000);
   
